<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manhwa Editor</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="sidebar">
  <h1>ğŸ“– Manhwa Editor</h1>

  <div class="sec">Add Panels</div>
  <div id="upload-area" onclick="document.getElementById('fi').click()">
    <input type="file" id="fi" accept="image/*" multiple onchange="handleFiles(event)">
    â• Upload images
  </div>

  <div class="sec">Page Panels</div>
  <div id="panels-list"></div>

  <!-- PANEL CONTROLS -->
  <div id="pc" style="display:none">
    <div class="sec">Panel</div>
    <label>Height (px)</label>
    <input type="number" id="ph" value="450" min="80" max="1400" onchange="upH()">
    <label>Offset Y</label>
    <input type="range" id="oy" min="-800" max="400" value="0" oninput="upOY()">
    <label>Offset X</label>
    <input type="range" id="ox" min="-600" max="600" value="0" oninput="upOX()">
    <label>Scale (%)</label>
    <input type="range" id="sc" min="40" max="300" value="100" oninput="upSC()">

    <div class="sec" style="margin-top:3px">Row Layout</div>
    <div class="brow">
      <button class="btn bb" onclick="mergeRow()">âŠ Mergeâ†“</button>
      <button class="btn bd" onclick="splitRow()">âŠŸ Split</button>
      <button class="btn bo" onclick="swapRow()">â‡„ Swap L/R</button>
    </div>

    <div class="sec" style="margin-top:3px">Panel Groups</div>
    <div class="brow">
      <button class="btn bb" onclick="createGroup()">âŠ Groupâ†“</button>
      <button class="btn bo" onclick="changeGroupLayout()">â‡„ Layout</button>
    </div>

    <div class="sec" style="margin-top:3px">Add Bubble</div>
    <div class="brow">
      <button class="btn by" onclick="addBubble('speech')">ğŸ’¬ Speech</button>
      <button class="btn bd" onclick="addBubble('thought')">ğŸ’­ Thought</button>
      <button class="btn bb" onclick="addBubble('sfx')">ğŸ’¥ SFX</button>
    </div>

    <div class="sec" style="margin-top:3px">Bubbles on Panel</div>
    <div id="blist"></div>

    <!-- BUBBLE EDIT -->
    <div id="be" style="display:none;margin-top:5px;border-top:1px solid #333;padding-top:7px">
      <label>Text</label>
      <textarea id="bt" oninput="upBT()"></textarea>
      <label>Font size: <span id="fsv">13</span>px</label>
      <input type="range" id="bfs" min="8" max="48" value="13" oninput="upBFS()">
      <label>Shape</label>
      <select id="bshape" onchange="upBShape()">
        <option value="oval">Oval / Circle</option>
        <option value="rectangle">Rectangle</option>
        <option value="parallelogram">Parallelogram</option>
        <option value="cloud">Cloud</option>
        <option value="spike">Spike / Shout</option>
      </select>
      <label>Border Style</label>
      <select id="bborderstyle" onchange="upBBorderStyle()">
        <option value="solid">Solid</option>
        <option value="dashed">Dashed</option>
        <option value="dotted">Dotted</option>
        <option value="double">Double</option>
        <option value="none">None (borderless)</option>
      </select>
      <label>Tail</label>
      <select id="btail" onchange="upBTail()">
        <option value="bottom-left">â†™ Bottom Left</option>
        <option value="bottom-center">â†“ Bottom Center</option>
        <option value="bottom-right">â†˜ Bottom Right</option>
        <option value="top-left">â†– Top Left</option>
        <option value="top-center">â†‘ Top Center</option>
        <option value="top-right">â†— Top Right</option>
        <option value="left">â† Left</option>
        <option value="right">â†’ Right</option>
        <option value="none">No tail</option>
      </select>
      <div class="cprow" style="margin-top:4px">
        <label>Fill</label>
        <input type="color" id="bfill" value="#ffffff" oninput="upBColors()">
        <label>Text</label>
        <input type="color" id="btcol" value="#000000" oninput="upBColors()">
        <label>Border</label>
        <input type="color" id="bstroke" value="#000000" oninput="upBColors()">
      </div>
      <div class="brow" style="margin-top:4px">
        <button class="btn br" onclick="delSelBubble()">ğŸ—‘ Delete</button>
      </div>
    </div>

    <div class="sec" style="margin-top:3px">Overlays on Panel</div>
    <div id="overlay-list"></div>
  </div>

  <!-- BUBBLE PRESETS -->
  <div id="preset-area">
    <div class="sec">Bubble Presets</div>
    <div id="preset-list"></div>
    <button class="btn bb" style="margin-top:4px;width:100%" onclick="saveCurrentAsPreset()">ğŸ’¾ Save Current as Preset</button>
  </div>

  <!-- ASSET LIBRARY -->
  <div id="asset-library">
    <div class="sec">Asset Library</div>
    <div style="font-size:10px;color:#666;margin-bottom:4px">Drag onto a panel to add overlay</div>
    <div id="asset-items"></div>
  </div>

  <!-- JSON IMPORT -->
  <div id="json-area">
    <div class="sec">JSON Bubble Import</div>
    <div style="font-size:10px;color:#666;line-height:1.5">
      <b style="color:#aaa">panelIndex</b> = panel number on page (1=first).<br>
      Omit panelIndex â†’ goes to selected panel.<br>
      Keys: type, text, tail, panelIndex,<br>fontSize, fillColor, textColor, shape, borderStyle
    </div>
    <textarea id="json-input" placeholder='[
  {"panelIndex":1,"type":"speech","text":"No, no, no!","tail":"bottom-right"},
  {"panelIndex":1,"type":"speech","text":"MORE TRAGEDY!","tail":"bottom-left"},
  {"panelIndex":2,"type":"sfx","text":"STOP!","tail":"none"},
  {"panelIndex":3,"type":"thought","text":"...","tail":"top-left"}
]'></textarea>
    <button class="btn by" onclick="importJSON()">âš¡ Import Bubbles to Panel</button>
    <div id="json-err" style="font-size:10px;color:#f88;display:none"></div>
  </div>

  <!-- EVENT HISTORY LOG -->
  <div id="history-panel">
    <div class="sec" style="display:flex;align-items:center;justify-content:space-between">
      <span>Event History</span>
      <span style="display:flex;gap:3px">
        <button class="btn bd" style="font-size:9px;padding:1px 4px" onclick="HistoryLog.exportTxt()">ğŸ“¥ Export</button>
        <button class="btn br" style="font-size:9px;padding:1px 4px" onclick="HistoryLog.clear()">ğŸ—‘</button>
      </span>
    </div>
    <div id="history-list" style="max-height:120px;overflow-y:auto"></div>
  </div>

  <!-- AUTO-SAVE & EXPORT -->
  <div style="margin-top:auto;padding-top:7px;border-top:1px solid #333;display:flex;flex-direction:column;gap:4px">
    <div id="autosave-status">Auto-save active</div>
    <div class="brow">
      <button class="btn bg" style="flex:1;font-size:14px" onclick="exportPage()">ğŸ’¾ Export PNG</button>
      <button class="btn br" style="font-size:11px" onclick="clearAll()">ğŸ—‘ Reset</button>
    </div>
  </div>
</div>

<div id="canvas-wrap">
  <div id="toolbar">
    <span>ğŸ“ 800px</span>
    <span id="tinfo">Upload images to start</span>
  </div>
  <div id="page-canvas"></div>
  <div style="width:800px;display:flex;justify-content:flex-end;margin-top:4px">
    <button class="btn bg" onclick="exportPage()">ğŸ’¾ Export PNG</button>
  </div>
</div>

<script src="history.js"></script>
<script src="bubbles.js"></script>
<script src="layers.js"></script>
<script src="app.js"></script>
</body>
</html>
